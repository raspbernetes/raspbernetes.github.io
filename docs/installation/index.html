<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="generator" content="Docusaurus v2.0.0-alpha.56">
<title data-react-helmet="true">Installation | Raspernetes</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:title" content="Installation | Raspernetes"><meta data-react-helmet="true" name="description" content="This guide will walk through the steps required to bootstrap a running Kubernetes cluster with a highly available topology. You will learn and configure the CRI and CNI of your choice (assuming it is supported) and understand how to setup load balancing between your multi master cluster."><meta data-react-helmet="true" property="og:description" content="This guide will walk through the steps required to bootstrap a running Kubernetes cluster with a highly available topology. You will learn and configure the CRI and CNI of your choice (assuming it is supported) and understand how to setup load balancing between your multi master cluster."><meta data-react-helmet="true" property="og:url" content="https://raspbernetes.github.io/docs/installation"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://raspbernetes.github.io/docs/installation"><link rel="stylesheet" href="/styles.cadbe1e8.css">
<link rel="preload" href="/styles.aaff6fcd.js" as="script">
<link rel="preload" href="/runtime~main.152a773d.js" as="script">
<link rel="preload" href="/main.5641ffae.js" as="script">
<link rel="preload" href="/common.b899ee34.js" as="script">
<link rel="preload" href="/2.5fe19710.js" as="script">
<link rel="preload" href="/1be78505.56e20c7c.js" as="script">
<link rel="preload" href="/27.bd733d75.js" as="script">
<link rel="preload" href="/20ac7829.fbe2cca5.js" as="script">
<link rel="preload" href="/3b8c55ea.34825c77.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=window.matchMedia("(prefers-color-scheme: dark)"),n=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();null!==n?t(n):e.matches&&t("dark")}()</script><div id="__docusaurus">
<nav class="navbar navbar--light navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" href="/"><img class="navbar__logo" src="/img/logo.svg" alt="Raspernetes Logo"><strong class="navbar__title">Raspernetes</strong></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/">Docs</a><a class="navbar__item navbar__link" href="/blog">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/raspbernetes" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_1gtM"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_keGJ moon_1gwN"></span></div><div class="react-toggle-track-x"><span class="toggle_keGJ sun_3CPA"></span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><img class="navbar__logo" src="/img/logo.svg" alt="Raspernetes Logo"><strong class="navbar__title">Raspernetes</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" href="/docs/">Docs</a></li><li class="menu__list-item"><a class="menu__link" href="/blog">Blog</a></li><li class="menu__list-item"><a href="https://github.com/raspbernetes" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_1kjD"><div class="docSidebarContainer_1cYp"><div class="sidebar_1kLs"><div class="menu menu--responsive menu_w2sC"><button aria-label="Open Menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_2vk4" xmlns="http://www.w3.org/2000/svg" height="24" width="24" viewBox="0 0 32 32" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Raspbernetes</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/doc1">Introduction</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/doc2">Design Principles</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/doc3">Contributing</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">Getting Started</a><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/docs/installation">Installation</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Advanced</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/architecture">Architecture</a></li></ul></li></ul></div></div></div><main class="docMainContainer_FFX1"><div class="container padding-vert--lg docItemWrapper_1cc7"><div class="row"><div class="col docItemCol_2GOA"><div class="docItemContainer_2cwg"><article><header><h1 class="docTitle_1vWb">Installation</h1></header><div class="markdown"><p>This guide will walk through the steps required to bootstrap a running Kubernetes cluster with a highly available topology. You will learn and configure the CRI and CNI of your choice (assuming it is supported) and understand how to setup load balancing between your multi master cluster.</p><blockquote><p>Note: If you wish to use Raspbian Lite please use the following <a href="raspbian/README.md">guide</a>.</p></blockquote><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="repository-structure"></a>Repository Structure<a aria-hidden="true" tabindex="-1" class="hash-link" href="#repository-structure" title="Direct link to heading">#</a></h2><p>The repository used to install kubernetes can be found here: <a href="https://github.com/raspbernetes/k8s-cluster-installation" target="_blank" rel="noopener noreferrer">https://github.com/raspbernetes/k8s-cluster-installation</a></p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-bash codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token builtin class-name" style="color:rgb(255, 203, 107)">.</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">├── .github     </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># Github workflows and CODEOWNERS files</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">├── ansible     </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># Ansible playbook to run after the RPis have been flashed</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">├── cloudflare  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># k8s resources for cloudflare auth healthcheck configuration</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">├── docs        </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># Documentation</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">├── rasbian     </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># k8s bootstrap scripts (deprecated)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">└── setup       </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># Cloud init scripts used to flash RPis</span></div></div></div></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="prerequisites"></a>Prerequisites<a aria-hidden="true" tabindex="-1" class="hash-link" href="#prerequisites" title="Direct link to heading">#</a></h2><p>Prior to getting started you will need to have several things done first. Assuming you already have the <a href="#Hardware">hardware</a> available, you will need to do the following:</p><ol><li>Flash OS onto SD card. Guide <a href="setup/README.md">Here</a></li><li>Install Ansible. Download <a href="https://docs.ansible.com/ansible/latest/installation_guide/intro_installation.html">Here</a></li><li>SSH connectivity to each node. (Step 1 requires you setup SSH keys)</li></ol><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="lets-begin"></a>Lets Begin<a aria-hidden="true" tabindex="-1" class="hash-link" href="#lets-begin" title="Direct link to heading">#</a></h2><p>Once the Raspberry Pi&#x27;s are running and all the prerequisites have been completed we&#x27;re now ready to setup the Ansible inventory.</p><p>Open the <a href="/docs/ansible/inventory">inventory file</a> - each machine that will be joining the Kubernetes cluster must be defined as either a master or worker node. To leverage the highly available topology configuration you would ideally have 3 masters available as a minimum, otherwise 1 master node is fine, however, it won&#x27;t be highly available.</p><blockquote><p>Note: Ensure the <code>hostname</code> matches what the machine was given when flashed the SD card and <code>ansible_host</code> matches the IP allocated to the host on your preferred subnet.</p></blockquote><p>When the inventory has been configured with all the hosts that will be joining the Kubernetes cluster we can run the following command to verify SSH connectivity can be established.</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-bash codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">ansible all -m </span><span class="token function" style="color:rgb(130, 170, 255)">ping</span><span class="token plain"> -i ansible/inventory -u pi</span></div></div></div></div></div><p>A successful response should look something like the following:</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-diff codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">k8s-worker-01 | SUCCESS =&gt; {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token unchanged">  ...</span></div><div class="token-line" style="color:#bfc7d5"><span class="token unchanged">  &quot;changed&quot;: false,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token unchanged">  &quot;ping&quot;: &quot;pong&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token unchanged">  ...</span></div><div class="token-line" style="color:#bfc7d5"><span class="token unchanged"></span><span class="token plain">}</span></div></div></div></div></div><blockquote><p>Note: If your output returns success for each ping then you can continue, otherwise there may be some misconfiguration of either the inventory file, or network connectivity issues.</p></blockquote><p>There are a variety of different configurable options in the Ansible automation. These options can be located in the <a href="ansible/vars.yml">vars.yml</a> file.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="container-runtime-interface"></a>Container Runtime Interface<a aria-hidden="true" tabindex="-1" class="hash-link" href="#container-runtime-interface" title="Direct link to heading">#</a></h2><p>Below is a matrix of the currently supported options.</p><p><strong>Container Runtime</strong></p><table><thead><tr><th>Name</th><th>Supported</th></tr></thead><tbody><tr><td>Docker</td><td>Yes</td></tr><tr><td>ContainerD</td><td>Yes</td></tr></tbody></table><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="container-network-interace"></a>Container Network Interace<a aria-hidden="true" tabindex="-1" class="hash-link" href="#container-network-interace" title="Direct link to heading">#</a></h2><p><strong>Container Network Interface</strong></p><table><thead><tr><th>Name</th><th>Supported</th></tr></thead><tbody><tr><td>Weave</td><td>Yes</td></tr><tr><td>Flannel</td><td>Yes</td></tr></tbody></table><p>Assuming all previous steps and configuration are correct the last thing to do is to execute the playbook. The playbook that should be used is the <code>k8s-all.yml</code> playbook, this will handle all the master and worker node logic and sequencing.</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-bash codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token function" style="color:rgb(130, 170, 255)">env</span><span class="token plain"> </span><span class="token assign-left variable" style="color:rgb(191, 199, 213)">ANSIBLE_CONFIG</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">ansible.cfg ansible-playbook </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    -i ansible/inventory </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    ansible/playbooks/k8s-all.yml</span></div></div></div></div></div><p>If there was no errors you should be able to execute the following command to check the status of the nodes in the cluster:</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-bash codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">k get nodes --kubeconfig ansible/playbooks/output/k8s-config.yaml</span></div></div></div></div></div><p>Output:</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-bash codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">NAME            STATUS     ROLES    AGE     VERSION</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">k8s-master-01   Ready      master   4m45s   v1.17.4</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">k8s-master-02   Ready      master   70s     v1.17.4</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">k8s-master-03   Ready      master   79s     v1.17.4</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">k8s-worker-01   Ready      </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">none</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain">   16s     v1.17.4</span></div></div></div></div></div><p><strong>Congratulations!</strong> you have successfully started your own Kubernetes cluster!</p><blockquote><p>If you weren&#x27;t lucky enough to have everything successful on the first attempt please open an <a href="https://github.com/raspbernetes/k8s-cluster-installation/issues/new" target="_blank" rel="noopener noreferrer">issue</a> with as much context and we&#x27;ll try to solve and improve for future people.</p></blockquote><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="network-topology"></a>Network topology<a aria-hidden="true" tabindex="-1" class="hash-link" href="#network-topology" title="Direct link to heading">#</a></h2><table><thead><tr><th align="center">IP</th><th align="center">Function</th></tr></thead><tbody><tr><td align="center">192.168.1.1</td><td align="center">Router</td></tr><tr><td align="center">192.168.1.121</td><td align="center">master (k8s-master-01)</td></tr><tr><td align="center">192.168.1.122</td><td align="center">master (k8s-master-02)</td></tr><tr><td align="center">192.168.1.123</td><td align="center">master (k8s-master-03)</td></tr><tr><td align="center">192.168.1.131</td><td align="center">worker (k8s-worker-01)</td></tr></tbody></table></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/raspbernetes/docs/edit/master/website/docs/installation.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 40 40" style="margin-right:0.3em;vertical-align:sub"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/doc3"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">« Contributing</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/architecture"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Architecture »</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_TbNY"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#repository-structure" class="table-of-contents__link">Repository Structure</a></li><li><a href="#prerequisites" class="table-of-contents__link">Prerequisites</a></li><li><a href="#lets-begin" class="table-of-contents__link">Lets Begin</a></li><li><a href="#container-runtime-interface" class="table-of-contents__link">Container Runtime Interface</a></li><li><a href="#container-network-interace" class="table-of-contents__link">Container Network Interace</a></li><li><a href="#network-topology" class="table-of-contents__link">Network topology</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Docs</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/">Guides</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Community</h4><ul class="footer__items"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/raspernetes" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow</a></li><li class="footer__item"><a href="https://discordapp.com/invite/raspernetes" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord</a></li><li class="footer__item"><a href="https://twitter.com/raspernetes" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">More</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/raspbernetes" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub</a></li></ul></div></div><div class="text--center"><div>Copyright © 2020 Raspernetes, Inc. Built with ❤️</div></div></div></footer></div>
<script src="/styles.aaff6fcd.js"></script>
<script src="/runtime~main.152a773d.js"></script>
<script src="/main.5641ffae.js"></script>
<script src="/common.b899ee34.js"></script>
<script src="/2.5fe19710.js"></script>
<script src="/1be78505.56e20c7c.js"></script>
<script src="/27.bd733d75.js"></script>
<script src="/20ac7829.fbe2cca5.js"></script>
<script src="/3b8c55ea.34825c77.js"></script>
</body>
</html>
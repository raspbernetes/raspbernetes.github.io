<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="generator" content="Docusaurus v2.0.0-alpha.56">
<title data-react-helmet="true">Boot Raspberry Pi From USB SSD | Raspbernetes</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:title" content="Boot Raspberry Pi From USB SSD | Raspbernetes"><meta data-react-helmet="true" name="description" content="!USB Booting"><meta data-react-helmet="true" property="og:description" content="!USB Booting"><meta data-react-helmet="true" property="og:url" content="https://raspbernetes.github.io/docs/usb_booting"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://raspbernetes.github.io/docs/usb_booting"><link rel="stylesheet" href="/styles.5957e751.css">
<link rel="preload" href="/styles.efbe3c85.js" as="script">
<link rel="preload" href="/runtime~main.4f52ce9d.js" as="script">
<link rel="preload" href="/main.de31149c.js" as="script">
<link rel="preload" href="/1.6ef5ccd2.js" as="script">
<link rel="preload" href="/2.aad52cc2.js" as="script">
<link rel="preload" href="/3.a8e9dd53.js" as="script">
<link rel="preload" href="/1be78505.660c4eb0.js" as="script">
<link rel="preload" href="/39.ecb794b5.js" as="script">
<link rel="preload" href="/20ac7829.ad639e8b.js" as="script">
<link rel="preload" href="/ba9de945.766f77d1.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=window.matchMedia("(prefers-color-scheme: dark)"),n=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();null!==n?t(n):e.matches&&t("dark")}()</script><div id="__docusaurus">
<nav class="navbar navbar--light navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" href="/"><img class="navbar__logo" src="/img/logo.svg" alt="Raspbernetes Logo"><strong class="navbar__title">Raspbernetes</strong></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/">Docs</a><a class="navbar__item navbar__link" href="/blog">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/raspbernetes" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_1gtM"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_keGJ moon_1gwN"></span></div><div class="react-toggle-track-x"><span class="toggle_keGJ sun_3CPA"></span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><img class="navbar__logo" src="/img/logo.svg" alt="Raspbernetes Logo"><strong class="navbar__title">Raspbernetes</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" href="/docs/">Docs</a></li><li class="menu__list-item"><a class="menu__link" href="/blog">Blog</a></li><li class="menu__list-item"><a href="https://github.com/raspbernetes" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_1kjD"><div class="docSidebarContainer_1cYp"><div class="sidebar_1kLs"><div class="menu menu--responsive menu_w2sC"><button aria-label="Open Menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_2vk4" xmlns="http://www.w3.org/2000/svg" height="24" width="24" viewBox="0 0 32 32" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Raspbernetes</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/introduction">Introduction</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/styleguide">Style Guide</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/contributing">Contributing</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Getting Started</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/installation">Installation</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">Advanced</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/remote_kubectl_access">Remote Kubectl Access</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/encrypt_secrets">Encrypt Secrets</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/docs/usb_booting">Boot Raspberry Pi From USB SSD</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Security</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/cis-benchmark">CIS Benchmark</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/kubesec-benchmark">Kubesec Benchmark</a></li></ul></li></ul></div></div></div><main class="docMainContainer_FFX1"><div class="container padding-vert--lg docItemWrapper_1cc7"><div class="row"><div class="col docItemCol_2GOA"><div class="docItemContainer_2cwg"><article><header><h1 class="docTitle_1vWb">Boot Raspberry Pi From USB SSD</h1></header><div class="markdown"><p><img src="https://github.com/raspbernetes/raspbernetes.github.io/raw/master/img/usb-boot.png" alt="USB Booting" title="USB Booting"></p><p>While SD cards are the most standard method of booting a Raspberry Pi, they are not always suitable for applications that require rapid <a href="https://en.wikipedia.org/wiki/Input/output" target="_blank" rel="noopener noreferrer">I/O</a> or lots of I/O. Booting from USB is a feature that aims to help fix these two problems, in addition to inceasing the longevity of your storage.</p><div class="admonition admonition-warning alert alert--danger"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"></path></svg></span>warning</h5></div><div class="admonition-content"><p>Please proceed at your own risk. While I personally have not seen a case in which a Raspberry Pi has become &quot;bricked&quot; or inoperable, it is important to keep in mind that when you are altering the <code>EEPROM</code> you may experience a loss of data or a non-bootable system. We are not responsible/liable if you use this beta software and &quot;brick&quot; your Pi!</p></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="prerequisites"></a>Prerequisites<a aria-hidden="true" tabindex="-1" class="hash-link" href="#prerequisites" title="Direct link to heading">#</a></h2><ul><li>Raspberry Pi (In this example we will be using a Raspberry Pi 4, 4GB)</li><li>USB to SATA adapter<ul><li>See <a href="#USBs">Known Working USB to SATA Adapters</a></li></ul></li><li>SATA SSD<ul><li>SSDs are recommended for this beacuse they have lower power requirements and are much faster that typical HDDs</li><li>See <a href="#SSDs">Known Working SSDs</a></li></ul></li><li>SD Card</li><li><a href="https://ubuntu.com/download/raspberry-pi" target="_blank" rel="noopener noreferrer">Ubuntu 20.04</a></li><li><a href="https://downloads.raspberrypi.org/raspios_arm64/images/raspios_arm64-2020-05-28/2020-05-27-raspios-buster-arm64.zip">Raspberry Pi OS</a><ul><li>Link is to 64 bit which is still in Beta as of this writing.</li></ul></li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="booting-raspberry-pi-via-usb-ssd"></a>Booting Raspberry Pi via USB SSD<a aria-hidden="true" tabindex="-1" class="hash-link" href="#booting-raspberry-pi-via-usb-ssd" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="testing-equipment"></a>Testing Equipment<a aria-hidden="true" tabindex="-1" class="hash-link" href="#testing-equipment" title="Direct link to heading">#</a></h3><p>Before we start it is important to verify that your equipment is functioning correctly. We can do this by first flashing our SD card with <em>Raspberry Pi OS</em> and running it on our Pi. For brevity I will be omitting the process of flashing the SD card since this is a more Advanced guide. If you need help with this, please see <a href="https://raspbernetes.github.io/docs/installation" target="_blank" rel="noopener noreferrer">Installation</a>.</p><p>Once you have booted into Raspberry Pi OS, feel free to connect your SSD to the USB to SATA adapter and plug it into the Pi. I have witnessed issues when using the USB 2.0 ports (the ports that are black), so please use the USB 3.0 ports (blue). After it is plugged in, verify that you can see the drive:</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-bash codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">lsblk</span></div></div></div></div></div><p>The output from this command should show you a block device, most likely called <code>sda</code> or something prefaced with <code>sd</code>. If you don&#x27;t see your USB SSD immediately, try switching to the other 3.0 USB port, or trying a different USB to SATA cable/adapter.</p><p>Once your disk is detected we&#x27;ve confirmed that it is useable by the Pi, so it is safe to disconnect the drive from the Pi.</p><p>Awesome! Our disk is detected. Now we move on to the technical stuff...</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="updating-pi-firmware"></a>Updating Pi Firmware<a aria-hidden="true" tabindex="-1" class="hash-link" href="#updating-pi-firmware" title="Direct link to heading">#</a></h3><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="update-raspberry-pi-os"></a>Update Raspberry Pi OS<a aria-hidden="true" tabindex="-1" class="hash-link" href="#update-raspberry-pi-os" title="Direct link to heading">#</a></h4><p>While your Pi is still booted to Raspberry Pi OS, run a full update on the SD card&#x27;s OS:</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-bash codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token function" style="color:rgb(130, 170, 255)">sudo</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">apt</span><span class="token plain"> update</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">sudo</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">apt</span><span class="token plain"> full-upgrade -y</span></div></div></div></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="start-flashing-usb-ssd"></a>Start Flashing USB SSD<a aria-hidden="true" tabindex="-1" class="hash-link" href="#start-flashing-usb-ssd" title="Direct link to heading">#</a></h4><p>While the update is running, we can go ahead and flash the Ubuntu image onto our SSD. Feel free to unplug it from the Pi and image it how you see fit. It can take a little while, best to get it going while doing other things.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="change-bootloader-branch"></a>Change Bootloader Branch<a aria-hidden="true" tabindex="-1" class="hash-link" href="#change-bootloader-branch" title="Direct link to heading">#</a></h4><p>With your freshly updated Rasberry Pi OS run the following to check your current bootloader version, making note of the returned version:</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-bash codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">vcgencmd bootloader_version</span></div></div></div></div></div><p>Switch the EEPROM firmware branch:</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-bash codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token function" style="color:rgb(130, 170, 255)">sudo</span><span class="token plain"> </span><span class="token builtin class-name" style="color:rgb(255, 203, 107)">echo</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;FIRMWARE_RELEASE_STATUS=&quot;stable&quot;&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> /etc/default/rpi-eeprom-update</span></div></div></div></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="update-pi-bootloader-settings"></a>Update Pi Bootloader Settings<a aria-hidden="true" tabindex="-1" class="hash-link" href="#update-pi-bootloader-settings" title="Direct link to heading">#</a></h4><p>Replace the current bootloader configuration settings with the beta ones that allow for USB booting:</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-bash codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token function" style="color:rgb(130, 170, 255)">sudo</span><span class="token plain"> rpi-eeprom-update -d -f /lib/firmware/raspberrypi/bootloader/stable/pieeprom-2020-06-15.bin</span></div></div></div></div></div><p>This command will prompt you to reboot, so we can do so:</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-bash codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token function" style="color:rgb(130, 170, 255)">sudo</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">reboot</span><span class="token plain"> now</span></div></div></div></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="verify-bootloader-firmware-version"></a>Verify Bootloader Firmware Version<a aria-hidden="true" tabindex="-1" class="hash-link" href="#verify-bootloader-firmware-version" title="Direct link to heading">#</a></h4><p>Once you&#x27;re booted back to the SD card on Raspberry Pi OS, check the bootloader version once again:</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-bash codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">vcgencmd bootloader_version</span></div></div></div></div></div><p>This version should be different from the one that was reported before our <code>rpi-eeprom-update</code> command.</p><p>Congratulations, your Pi is now able to boot from USB! However, we aren&#x27;t quite there yet.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="setting-up-our-ssd-for-use-with-usb-booting"></a>Setting Up our SSD for use with USB Booting<a aria-hidden="true" tabindex="-1" class="hash-link" href="#setting-up-our-ssd-for-use-with-usb-booting" title="Direct link to heading">#</a></h3><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>I personally found this part easier to do from our Raspberry Pi that I just got done flashing the firmware on. For that reason this section will be written from that perspective, but this should be possible using any Linux-based system.</p></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="drop-in-pi-specific-firmware"></a>Drop in Pi-Specific Firmware<a aria-hidden="true" tabindex="-1" class="hash-link" href="#drop-in-pi-specific-firmware" title="Direct link to heading">#</a></h4><p>Plug in your SSD that has been flashed with Ubuntu 20.04. The <code>system-boot</code> and <code>writeable</code> partitions should automatically be mounted to <code>/media/pi/system-boot</code> and <code>/media/pi/writeable</code>, respectively.</p><p>Change directory to <code>system-boot</code>.</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-bash codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token builtin class-name" style="color:rgb(255, 203, 107)">cd</span><span class="token plain"> /media/pi/system-boot</span></div></div></div></div></div><p>Run the following <a href="https://gist.github.com/atomicstack/9c43e452c4b7cefb37c1e78f65b0b1fa" target="_blank" rel="noopener noreferrer">one-liner</a> to patch the bootloader on our SSD with the applicable Pi firmware:</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-bash codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token function" style="color:rgb(130, 170, 255)">wget</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">$(</span><span class="token variable" style="color:rgb(191, 199, 213)"> </span><span class="token variable function" style="color:rgb(130, 170, 255)">wget</span><span class="token variable" style="color:rgb(191, 199, 213)"> -qO - https://github.com/raspberrypi/firmware/tree/master/boot </span><span class="token variable operator" style="color:rgb(137, 221, 255)">|</span><span class="token variable" style="color:rgb(191, 199, 213)"> perl -nE </span><span class="token variable string" style="color:rgb(195, 232, 141)">&#x27;chomp; next unless /[.](elf|dat)/; s/.*href=&quot;([^&quot;]+)&quot;.*/</span><span class="token variable string variable" style="color:rgb(191, 199, 213)">$1</span><span class="token variable string" style="color:rgb(195, 232, 141)">/; s/blob/raw/; say qq{https://github.com</span><span class="token variable string variable" style="color:rgb(191, 199, 213)">$_</span><span class="token variable string" style="color:rgb(195, 232, 141)">}&#x27;</span><span class="token variable" style="color:rgb(191, 199, 213)"> </span><span class="token variable" style="color:rgb(191, 199, 213)">)</span></div></div></div></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="dealing-with-compressed-kernel"></a>Dealing with Compressed Kernel<a aria-hidden="true" tabindex="-1" class="hash-link" href="#dealing-with-compressed-kernel" title="Direct link to heading">#</a></h4><p>Copy the compressed Linux kernel to your home directory:</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-bash codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token function" style="color:rgb(130, 170, 255)">cp</span><span class="token plain"> /media/pi/system-boot/vmlinuz ~/</span></div></div></div></div></div><p>Decompress the Linux kernel:</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-bash codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">zcat ~/vmlinuz </span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> ~/vmlinux</span></div></div></div></div></div><p>Copy the decompressed kernel to <code>system-boot</code>:</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-bash codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token function" style="color:rgb(130, 170, 255)">cp</span><span class="token plain"> ~/vmlinux /media/pi/system-boot/</span></div></div></div></div></div><p>Next create a script that will automatically decompress the kernel so that we can reboot the Pi without having to do the previous steps manually every boot:</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-bash codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token function" style="color:rgb(130, 170, 255)">cat</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;&lt;</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;EOF&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain">/media/pi/system-boot/auto_decompress_kernel</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">#!/bin/bash -e</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">#Set Variables</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(191, 199, 213)">BTPATH</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">/boot/firmware</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(191, 199, 213)">CKPATH</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token variable" style="color:rgb(191, 199, 213)">$BTPATH</span><span class="token plain">/vmlinuz</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(191, 199, 213)">DKPATH</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token variable" style="color:rgb(191, 199, 213)">$BTPATH</span><span class="token plain">/vmlinux</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">#Check if compression needs to be done.</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain"> -e </span><span class="token variable" style="color:rgb(191, 199, 213)">$BTPATH</span><span class="token plain">/check.md5 </span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">then</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> md5sum --status --ignore-missing -c </span><span class="token variable" style="color:rgb(191, 199, 213)">$BTPATH</span><span class="token plain">/check.md5</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">then</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token builtin class-name" style="color:rgb(255, 203, 107)">echo</span><span class="token plain"> -e </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;</span><span class="token string entity" style="color:rgb(195, 232, 141)">\e</span><span class="token string" style="color:rgb(195, 232, 141)">[32mFiles have not changed, Decompression not needed</span><span class="token string entity" style="color:rgb(195, 232, 141)">\e</span><span class="token string" style="color:rgb(195, 232, 141)">[0m&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token builtin class-name" style="color:rgb(255, 203, 107)">exit</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">else</span><span class="token plain"> </span><span class="token builtin class-name" style="color:rgb(255, 203, 107)">echo</span><span class="token plain"> -e </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;</span><span class="token string entity" style="color:rgb(195, 232, 141)">\e</span><span class="token string" style="color:rgb(195, 232, 141)">[31mHash failed, kernel will be compressed</span><span class="token string entity" style="color:rgb(195, 232, 141)">\e</span><span class="token string" style="color:rgb(195, 232, 141)">[0m&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">fi</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">fi</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">#Backup the old decompressed kernel</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">mv</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">$DKPATH</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">$DKPATH</span><span class="token plain">.bak</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">!</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">$?</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">==</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">then</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token builtin class-name" style="color:rgb(255, 203, 107)">echo</span><span class="token plain"> -e </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;</span><span class="token string entity" style="color:rgb(195, 232, 141)">\e</span><span class="token string" style="color:rgb(195, 232, 141)">[31mDECOMPRESSED KERNEL BACKUP FAILED!</span><span class="token string entity" style="color:rgb(195, 232, 141)">\e</span><span class="token string" style="color:rgb(195, 232, 141)">[0m&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token builtin class-name" style="color:rgb(255, 203, 107)">exit</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">else</span><span class="token plain">    </span><span class="token builtin class-name" style="color:rgb(255, 203, 107)">echo</span><span class="token plain"> -e </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;</span><span class="token string entity" style="color:rgb(195, 232, 141)">\e</span><span class="token string" style="color:rgb(195, 232, 141)">[32mDecompressed kernel backup was successful</span><span class="token string entity" style="color:rgb(195, 232, 141)">\e</span><span class="token string" style="color:rgb(195, 232, 141)">[0m&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">fi</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">#Decompress the new kernel</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(255, 203, 107)">echo</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;Decompressing kernel: &quot;</span><span class="token variable" style="color:rgb(191, 199, 213)">$CKPATH</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;..............&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">zcat </span><span class="token variable" style="color:rgb(191, 199, 213)">$CKPATH</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">$DKPATH</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">!</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">$?</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">==</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">then</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token builtin class-name" style="color:rgb(255, 203, 107)">echo</span><span class="token plain"> -e </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;</span><span class="token string entity" style="color:rgb(195, 232, 141)">\e</span><span class="token string" style="color:rgb(195, 232, 141)">[31mKERNEL FAILED TO DECOMPRESS!</span><span class="token string entity" style="color:rgb(195, 232, 141)">\e</span><span class="token string" style="color:rgb(195, 232, 141)">[0m&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token builtin class-name" style="color:rgb(255, 203, 107)">exit</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">else</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token builtin class-name" style="color:rgb(255, 203, 107)">echo</span><span class="token plain"> -e </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;</span><span class="token string entity" style="color:rgb(195, 232, 141)">\e</span><span class="token string" style="color:rgb(195, 232, 141)">[32mKernel Decompressed Succesfully</span><span class="token string entity" style="color:rgb(195, 232, 141)">\e</span><span class="token string" style="color:rgb(195, 232, 141)">[0m&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">fi</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">#Hash the new kernel for checking</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">md5sum </span><span class="token variable" style="color:rgb(191, 199, 213)">$CKPATH</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">$DKPATH</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">$BTPATH</span><span class="token plain">/check.md5</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">!</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">$?</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">==</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">then</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token builtin class-name" style="color:rgb(255, 203, 107)">echo</span><span class="token plain"> -e </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;</span><span class="token string entity" style="color:rgb(195, 232, 141)">\e</span><span class="token string" style="color:rgb(195, 232, 141)">[31mMD5 GENERATION FAILED!</span><span class="token string entity" style="color:rgb(195, 232, 141)">\e</span><span class="token string" style="color:rgb(195, 232, 141)">[0m&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">else</span><span class="token plain"> </span><span class="token builtin class-name" style="color:rgb(255, 203, 107)">echo</span><span class="token plain"> -e </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;</span><span class="token string entity" style="color:rgb(195, 232, 141)">\e</span><span class="token string" style="color:rgb(195, 232, 141)">[32mMD5 generated Succesfully</span><span class="token string entity" style="color:rgb(195, 232, 141)">\e</span><span class="token string" style="color:rgb(195, 232, 141)">[0m&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">fi</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">#Exit</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(255, 203, 107)">exit</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">EOF</span></div></div></div></div></div><p>Create an <code>apt</code> hook that decompresses the kernel on updates:</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-bash codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token function" style="color:rgb(130, 170, 255)">cat</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;&lt;</span><span class="token plain">EOF </span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain">/media/pi/writeable/etc/apt/apt.conf.d/999_decompress_rpi_kernel</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">DPkg::Post-Invoke </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;/bin/bash /boot/firmware/auto_decompress_kernel&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">EOF</span></div></div></div></div></div><p>Make this hook executeable:</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-bash codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token function" style="color:rgb(130, 170, 255)">sudo</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">chmod</span><span class="token plain"> +x /media/pi/writeable/etc/apt/apt.conf.d/999_decompress_rpi_kernel</span></div></div></div></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="alter-the-bootloader-config"></a>Alter the Bootloader Config<a aria-hidden="true" tabindex="-1" class="hash-link" href="#alter-the-bootloader-config" title="Direct link to heading">#</a></h4><p>Edit the bootloader config in the <code>[rpi4]</code> section to look like this:</p><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>It may be necessary to make an additional parameter if your USB storage is uncharacteristically slow. Just uncomment the <code>boot_delay</code> parameter.</p></div></div><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-bash codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain">pi4</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(191, 199, 213)">max_framebuffers</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(191, 199, 213)">dtoverlay</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">vc4-fkms-v3d</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">#boot_delay</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(191, 199, 213)">kernel</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">vmlinux</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">initramfs initrd.img followkernel</span></div></div></div></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="wrapping-up"></a>Wrapping Up<a aria-hidden="true" tabindex="-1" class="hash-link" href="#wrapping-up" title="Direct link to heading">#</a></h3><p>Whew, that was a lot of stuff to do just to make our SSD image bootable! But that&#x27;s all. From here I suggest shutting down the Pi:</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-bash codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token function" style="color:rgb(130, 170, 255)">sudo</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">shutdown</span><span class="token plain"> now</span></div></div></div></div></div><p>Once the Pi is powered off, remove your SD card, double check to make sure your USB SSD is properly seated, and power it back on.</p><p>Your system should now boot from the USB SSD.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="verify-ssd-boot"></a>Verify SSD Boot<a aria-hidden="true" tabindex="-1" class="hash-link" href="#verify-ssd-boot" title="Direct link to heading">#</a></h4><p>After it&#x27;s booted give it a minute or so for <code>cloud-init</code> to complete, and log in with username and password <code>ubuntu</code>. It will prompt for a password change upon login. From here, we can check to make sure the SSD is mounted properly:</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-bash codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token function" style="color:rgb(130, 170, 255)">df</span><span class="token plain"> -h</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Filesystem      Size  Used Avail Use% Mounted on</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token plain">.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">/dev/sda2       110G  </span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token plain">.1G  104G   </span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token plain">% /</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token plain">.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">/dev/sda1       253M  157M   96M  </span><span class="token number" style="color:rgb(247, 140, 108)">63</span><span class="token plain">% /boot/firmware</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token plain">.</span></div></div></div></div></div><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="install-updates"></a>Install Updates<a aria-hidden="true" tabindex="-1" class="hash-link" href="#install-updates" title="Direct link to heading">#</a></h5><p>Go ahead and install updates for Ubuntu and reboot:</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-bash codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token function" style="color:rgb(130, 170, 255)">sudo</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">apt</span><span class="token plain"> update </span><span class="token operator" style="color:rgb(137, 221, 255)">&amp;&amp;</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">sudo</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">apt</span><span class="token plain"> full-upgrade -y</span></div></div></div></div></div><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-bash codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token function" style="color:rgb(130, 170, 255)">sudo</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">reboot</span><span class="token plain"> now</span></div></div></div></div></div><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="verify-reboots-are-working"></a>Verify Reboots are Working<a aria-hidden="true" tabindex="-1" class="hash-link" href="#verify-reboots-are-working" title="Direct link to heading">#</a></h5><p>When your host has rebooted, just make sure it boots back into Ubuntu. If it hangs or doesn&#x27;t make it to the OS, there is something wrong. Feel free to reach out to folks on the <a href="https://discord.gg/RGvKzVg" target="_blank" rel="noopener noreferrer">Discord</a> if you run into trouble.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="appendix"></a>Appendix<a aria-hidden="true" tabindex="-1" class="hash-link" href="#appendix" title="Direct link to heading">#</a></h3><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="relevant-links"></a>Relevant Links<a aria-hidden="true" tabindex="-1" class="hash-link" href="#relevant-links" title="Direct link to heading">#</a></h4><ul><li><a href="https://www.raspberrypi.org/documentation/hardware/raspberrypi/bcm2711_bootloader_config.md#usbmassstorageboot">https://www.raspberrypi.org/documentation/hardware/raspberrypi/bcm2711_bootloader_config.md#usbmassstorageboot</a></li><li><a href="https://www.raspberrypi.org/forums/viewtopic.php?t=278791">https://www.raspberrypi.org/forums/viewtopic.php?t=278791</a></li><li><a href="https://www.jeffgeerling.com/blog/2020/im-booting-my-raspberry-pi-4-usb-ssd" target="_blank" rel="noopener noreferrer">https://www.jeffgeerling.com/blog/2020/im-booting-my-raspberry-pi-4-usb-ssd</a></li><li><a href="https://gist.github.com/atomicstack/9c43e452c4b7cefb37c1e78f65b0b1fa" target="_blank" rel="noopener noreferrer">https://gist.github.com/atomicstack/9c43e452c4b7cefb37c1e78f65b0b1fa</a></li><li><a href="https://www.maketecheasier.com/boot-raspberry-pi-4-from-usb/" target="_blank" rel="noopener noreferrer">https://www.maketecheasier.com/boot-raspberry-pi-4-from-usb/</a></li></ul><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="products"></a>Products<a aria-hidden="true" tabindex="-1" class="hash-link" href="#products" title="Direct link to heading">#</a></h4><p>A list of products that have been known to work, verified by our Discord community. If you&#x27;re using different equipment with success, please make a PR to list it!</p><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="ssds"></a>SSDs<a aria-hidden="true" tabindex="-1" class="hash-link" href="#ssds" title="Direct link to heading">#</a></h5><ul><li><a href="https://www.amazon.com/gp/product/B01N6JQS8C/ref=ppx_yo_dt_b_asin_title_o03_s01?ie=UTF8&amp;psc=1" target="_blank" rel="noopener noreferrer">Kingston SA400S37</a></li></ul><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="usbs"></a>USBs<a aria-hidden="true" tabindex="-1" class="hash-link" href="#usbs" title="Direct link to heading">#</a></h5><ul><li><a href="https://www.amazon.com/gp/product/B00HJZJI84/ref=ppx_yo_dt_b_asin_title_o02_s00?ie=UTF8&amp;psc=1" target="_blank" rel="noopener noreferrer">StarTech USB3S2SAT3CB</a></li><li><a href="https://www.bestbuy.com/site/insignia-2-5-serial-ata-hard-drive-enclosure-black/5820005.p?skuId=5820005">Insignia NS-PCHD235</a></li></ul></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/raspbernetes/docs/edit/master/website/docs/usb-booting.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 40 40" style="margin-right:0.3em;vertical-align:sub"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/encrypt_secrets"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label"> Encrypt Secrets</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/cis-benchmark"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">CIS Benchmark </div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_TbNY"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#prerequisites" class="table-of-contents__link">Prerequisites</a></li><li><a href="#booting-raspberry-pi-via-usb-ssd" class="table-of-contents__link">Booting Raspberry Pi via USB SSD</a><ul><li><a href="#testing-equipment" class="table-of-contents__link">Testing Equipment</a></li><li><a href="#updating-pi-firmware" class="table-of-contents__link">Updating Pi Firmware</a></li><li><a href="#setting-up-our-ssd-for-use-with-usb-booting" class="table-of-contents__link">Setting Up our SSD for use with USB Booting</a></li><li><a href="#wrapping-up" class="table-of-contents__link">Wrapping Up</a></li><li><a href="#appendix" class="table-of-contents__link">Appendix</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Docs</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/">Guides</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Community</h4><ul class="footer__items"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/Raspbernetes" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow</a></li><li class="footer__item"><a href="https://discordapp.com/invite/Raspbernetes" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord</a></li><li class="footer__item"><a href="https://twitter.com/Raspbernetes" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">More</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/raspbernetes" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub</a></li></ul></div></div><div class="text--center"><div>Copyright  2020 Raspbernetes, Inc. Built with </div></div></div></footer></div>
<script src="/styles.efbe3c85.js"></script>
<script src="/runtime~main.4f52ce9d.js"></script>
<script src="/main.de31149c.js"></script>
<script src="/1.6ef5ccd2.js"></script>
<script src="/2.aad52cc2.js"></script>
<script src="/3.a8e9dd53.js"></script>
<script src="/1be78505.660c4eb0.js"></script>
<script src="/39.ecb794b5.js"></script>
<script src="/20ac7829.ad639e8b.js"></script>
<script src="/ba9de945.766f77d1.js"></script>
</body>
</html>